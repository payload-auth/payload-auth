import { jsx as _jsx } from "react/jsx-runtime";
import { redirect } from "next/navigation";
import React from "react";
import { TwoFactorVerifyForm } from "./client";
import { cookies } from "next/headers";
import { getSafeRedirect } from "../../utils/get-safe-redirect";
import { valueOrDefaultString } from "../../../../../shared/utils/value-or-default";
import { adminRoutes, supportedBAPluginIds } from "../../../constants";
import { MinimalTemplate } from "@payloadcms/next/templates";
const TwoFactorVerify = async ({ searchParams, initPageResult, pluginOptions, verificationsSlug })=>{
    const { req } = initPageResult;
    const { payload: { config }, payload } = req;
    const { admin: { routes: { login } }, routes: { admin: adminRoute } } = config;
    const cookieStore = await cookies();
    const loginRoute = valueOrDefaultString(login, adminRoutes.adminLogin);
    const redirectUrl = getSafeRedirect(searchParams?.redirect, adminRoute);
    const twoFactorOptions = pluginOptions.betterAuthOptions?.plugins?.find((plugin)=>plugin.id === supportedBAPluginIds.twoFactor)?.options ?? {};
    const twoFactorCookie = cookieStore.get(`${process.env.NODE_ENV === 'production' ? '__Secure-' : ''}better-auth.two_factor`)?.value;
    if (!twoFactorCookie) {
        redirect(`${adminRoute}${loginRoute}`);
    }
    const twoFactorVerifyToken = twoFactorCookie.split('.').at(0);
    if (!twoFactorVerifyToken) {
        redirect(`${adminRoute}${loginRoute}`);
    }
    const { totalDocs: isValidTwoFactorToken } = await payload.count({
        collection: verificationsSlug,
        where: {
            identifier: {
                equals: twoFactorVerifyToken
            }
        }
    });
    if (!isValidTwoFactorToken) {
        redirect(`${adminRoute}${loginRoute}`);
    }
    return /*#__PURE__*/ _jsx(MinimalTemplate, {
        className: "two-factor-verify",
        children: /*#__PURE__*/ _jsx(TwoFactorVerifyForm, {
            redirect: redirectUrl,
            twoFactorDigits: twoFactorOptions?.totpOptions?.digits,
            baseURL: pluginOptions.betterAuthOptions?.baseURL,
            basePath: pluginOptions.betterAuthOptions?.basePath
        })
    });
};
export default TwoFactorVerify;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9iZXR0ZXItYXV0aC9wbHVnaW4vcGF5bG9hZC92aWV3cy90d28tZmFjdG9yLXZlcmlmeS9pbmRleC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVkaXJlY3QgfSBmcm9tICduZXh0L25hdmlnYXRpb24nXG5pbXBvcnQgdHlwZSB7IEFkbWluVmlld1NlcnZlclByb3BzIH0gZnJvbSAncGF5bG9hZCdcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCdcbmltcG9ydCB7IFR3b0ZhY3RvclZlcmlmeUZvcm0gfSBmcm9tICcuL2NsaWVudCdcbmltcG9ydCB7IGNvb2tpZXMgfSBmcm9tICduZXh0L2hlYWRlcnMnXG5pbXBvcnQgeyBnZXRTYWZlUmVkaXJlY3QgfSBmcm9tICcuLi8uLi91dGlscy9nZXQtc2FmZS1yZWRpcmVjdCdcbmltcG9ydCB7IHZhbHVlT3JEZWZhdWx0U3RyaW5nIH0gZnJvbSAnQC9zaGFyZWQvdXRpbHMvdmFsdWUtb3ItZGVmYXVsdCdcbmltcG9ydCB7IGFkbWluUm91dGVzLCBzdXBwb3J0ZWRCQVBsdWdpbklkcyB9IGZyb20gJ0AvYmV0dGVyLWF1dGgvcGx1Z2luL2NvbnN0YW50cydcbmltcG9ydCB7IEJldHRlckF1dGhQbHVnaW5PcHRpb25zIH0gZnJvbSAnQC9iZXR0ZXItYXV0aC9wbHVnaW4vdHlwZXMnXG5pbXBvcnQgeyBNaW5pbWFsVGVtcGxhdGUgfSBmcm9tICdAcGF5bG9hZGNtcy9uZXh0L3RlbXBsYXRlcydcblxuaW50ZXJmYWNlIFR3b0ZhY3RvclZlcmlmeVByb3BzIGV4dGVuZHMgQWRtaW5WaWV3U2VydmVyUHJvcHMge1xuICBwbHVnaW5PcHRpb25zOiBCZXR0ZXJBdXRoUGx1Z2luT3B0aW9uc1xuICB2ZXJpZmljYXRpb25zU2x1Zzogc3RyaW5nXG59XG5cbmNvbnN0IFR3b0ZhY3RvclZlcmlmeTogUmVhY3QuRkM8VHdvRmFjdG9yVmVyaWZ5UHJvcHM+ID0gYXN5bmMgKHsgc2VhcmNoUGFyYW1zLCBpbml0UGFnZVJlc3VsdCwgcGx1Z2luT3B0aW9ucywgdmVyaWZpY2F0aW9uc1NsdWcgfSkgPT4ge1xuICBjb25zdCB7IHJlcSB9ID0gaW5pdFBhZ2VSZXN1bHRcbiAgY29uc3Qge1xuICAgIHBheWxvYWQ6IHsgY29uZmlnIH0sXG4gICAgcGF5bG9hZFxuICB9ID0gcmVxXG5cbiAgY29uc3Qge1xuICAgIGFkbWluOiB7XG4gICAgICByb3V0ZXM6IHsgbG9naW4gfVxuICAgIH0sXG4gICAgcm91dGVzOiB7IGFkbWluOiBhZG1pblJvdXRlIH1cbiAgfSA9IGNvbmZpZ1xuICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKVxuICBjb25zdCBsb2dpblJvdXRlID0gdmFsdWVPckRlZmF1bHRTdHJpbmcobG9naW4sIGFkbWluUm91dGVzLmFkbWluTG9naW4pXG4gIGNvbnN0IHJlZGlyZWN0VXJsID0gZ2V0U2FmZVJlZGlyZWN0KHNlYXJjaFBhcmFtcz8ucmVkaXJlY3QgYXMgc3RyaW5nLCBhZG1pblJvdXRlKVxuXG4gIGNvbnN0IHR3b0ZhY3Rvck9wdGlvbnMgPVxuICAgIHBsdWdpbk9wdGlvbnMuYmV0dGVyQXV0aE9wdGlvbnM/LnBsdWdpbnM/LmZpbmQoKHBsdWdpbikgPT4gcGx1Z2luLmlkID09PSBzdXBwb3J0ZWRCQVBsdWdpbklkcy50d29GYWN0b3IpPy5vcHRpb25zID8/IHt9XG5cbiAgY29uc3QgdHdvRmFjdG9yQ29va2llID0gY29va2llU3RvcmUuZ2V0KGAke3Byb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicgPyAnX19TZWN1cmUtJyA6ICcnfWJldHRlci1hdXRoLnR3b19mYWN0b3JgKT8udmFsdWVcbiAgaWYgKCF0d29GYWN0b3JDb29raWUpIHtcbiAgICByZWRpcmVjdChgJHthZG1pblJvdXRlfSR7bG9naW5Sb3V0ZX1gKVxuICB9XG4gIGNvbnN0IHR3b0ZhY3RvclZlcmlmeVRva2VuID0gdHdvRmFjdG9yQ29va2llLnNwbGl0KCcuJykuYXQoMClcbiAgaWYgKCF0d29GYWN0b3JWZXJpZnlUb2tlbikge1xuICAgIHJlZGlyZWN0KGAke2FkbWluUm91dGV9JHtsb2dpblJvdXRlfWApXG4gIH1cbiAgY29uc3QgeyB0b3RhbERvY3M6IGlzVmFsaWRUd29GYWN0b3JUb2tlbiB9ID0gYXdhaXQgcGF5bG9hZC5jb3VudCh7XG4gICAgY29sbGVjdGlvbjogdmVyaWZpY2F0aW9uc1NsdWcsXG4gICAgd2hlcmU6IHtcbiAgICAgIGlkZW50aWZpZXI6IHtcbiAgICAgICAgZXF1YWxzOiB0d29GYWN0b3JWZXJpZnlUb2tlblxuICAgICAgfVxuICAgIH1cbiAgfSlcbiAgaWYgKCFpc1ZhbGlkVHdvRmFjdG9yVG9rZW4pIHtcbiAgICByZWRpcmVjdChgJHthZG1pblJvdXRlfSR7bG9naW5Sb3V0ZX1gKVxuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8TWluaW1hbFRlbXBsYXRlIGNsYXNzTmFtZT1cInR3by1mYWN0b3ItdmVyaWZ5XCI+XG4gICAgICA8VHdvRmFjdG9yVmVyaWZ5Rm9ybVxuICAgICAgICByZWRpcmVjdD17cmVkaXJlY3RVcmx9XG4gICAgICAgIHR3b0ZhY3RvckRpZ2l0cz17dHdvRmFjdG9yT3B0aW9ucz8udG90cE9wdGlvbnM/LmRpZ2l0c31cbiAgICAgICAgYmFzZVVSTD17cGx1Z2luT3B0aW9ucy5iZXR0ZXJBdXRoT3B0aW9ucz8uYmFzZVVSTH1cbiAgICAgICAgYmFzZVBhdGg9e3BsdWdpbk9wdGlvbnMuYmV0dGVyQXV0aE9wdGlvbnM/LmJhc2VQYXRofVxuICAgICAgLz5cbiAgICA8L01pbmltYWxUZW1wbGF0ZT5cbiAgKVxufVxuXG5leHBvcnQgZGVmYXVsdCBUd29GYWN0b3JWZXJpZnlcbiJdLCJuYW1lcyI6WyJyZWRpcmVjdCIsIlJlYWN0IiwiVHdvRmFjdG9yVmVyaWZ5Rm9ybSIsImNvb2tpZXMiLCJnZXRTYWZlUmVkaXJlY3QiLCJ2YWx1ZU9yRGVmYXVsdFN0cmluZyIsImFkbWluUm91dGVzIiwic3VwcG9ydGVkQkFQbHVnaW5JZHMiLCJNaW5pbWFsVGVtcGxhdGUiLCJUd29GYWN0b3JWZXJpZnkiLCJzZWFyY2hQYXJhbXMiLCJpbml0UGFnZVJlc3VsdCIsInBsdWdpbk9wdGlvbnMiLCJ2ZXJpZmljYXRpb25zU2x1ZyIsInJlcSIsInBheWxvYWQiLCJjb25maWciLCJhZG1pbiIsInJvdXRlcyIsImxvZ2luIiwiYWRtaW5Sb3V0ZSIsImNvb2tpZVN0b3JlIiwibG9naW5Sb3V0ZSIsImFkbWluTG9naW4iLCJyZWRpcmVjdFVybCIsInR3b0ZhY3Rvck9wdGlvbnMiLCJiZXR0ZXJBdXRoT3B0aW9ucyIsInBsdWdpbnMiLCJmaW5kIiwicGx1Z2luIiwiaWQiLCJ0d29GYWN0b3IiLCJvcHRpb25zIiwidHdvRmFjdG9yQ29va2llIiwiZ2V0IiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwidmFsdWUiLCJ0d29GYWN0b3JWZXJpZnlUb2tlbiIsInNwbGl0IiwiYXQiLCJ0b3RhbERvY3MiLCJpc1ZhbGlkVHdvRmFjdG9yVG9rZW4iLCJjb3VudCIsImNvbGxlY3Rpb24iLCJ3aGVyZSIsImlkZW50aWZpZXIiLCJlcXVhbHMiLCJjbGFzc05hbWUiLCJ0d29GYWN0b3JEaWdpdHMiLCJ0b3RwT3B0aW9ucyIsImRpZ2l0cyIsImJhc2VVUkwiLCJiYXNlUGF0aCJdLCJtYXBwaW5ncyI6IjtBQUFBLFNBQVNBLFFBQVEsUUFBUSxrQkFBaUI7QUFFMUMsT0FBT0MsV0FBVyxRQUFPO0FBQ3pCLFNBQVNDLG1CQUFtQixRQUFRLFdBQVU7QUFDOUMsU0FBU0MsT0FBTyxRQUFRLGVBQWM7QUFDdEMsU0FBU0MsZUFBZSxRQUFRLGdDQUErQjtBQUMvRCxTQUFTQyxvQkFBb0IsUUFBUSwrQ0FBaUM7QUFDdEUsU0FBU0MsV0FBVyxFQUFFQyxvQkFBb0IsUUFBUSxxQkFBZ0M7QUFFbEYsU0FBU0MsZUFBZSxRQUFRLDZCQUE0QjtBQU81RCxNQUFNQyxrQkFBa0QsT0FBTyxFQUFFQyxZQUFZLEVBQUVDLGNBQWMsRUFBRUMsYUFBYSxFQUFFQyxpQkFBaUIsRUFBRTtJQUMvSCxNQUFNLEVBQUVDLEdBQUcsRUFBRSxHQUFHSDtJQUNoQixNQUFNLEVBQ0pJLFNBQVMsRUFBRUMsTUFBTSxFQUFFLEVBQ25CRCxPQUFPLEVBQ1IsR0FBR0Q7SUFFSixNQUFNLEVBQ0pHLE9BQU8sRUFDTEMsUUFBUSxFQUFFQyxLQUFLLEVBQUUsRUFDbEIsRUFDREQsUUFBUSxFQUFFRCxPQUFPRyxVQUFVLEVBQUUsRUFDOUIsR0FBR0o7SUFDSixNQUFNSyxjQUFjLE1BQU1sQjtJQUMxQixNQUFNbUIsYUFBYWpCLHFCQUFxQmMsT0FBT2IsWUFBWWlCLFVBQVU7SUFDckUsTUFBTUMsY0FBY3BCLGdCQUFnQk0sY0FBY1YsVUFBb0JvQjtJQUV0RSxNQUFNSyxtQkFDSmIsY0FBY2MsaUJBQWlCLEVBQUVDLFNBQVNDLEtBQUssQ0FBQ0MsU0FBV0EsT0FBT0MsRUFBRSxLQUFLdkIscUJBQXFCd0IsU0FBUyxHQUFHQyxXQUFXLENBQUM7SUFFeEgsTUFBTUMsa0JBQWtCWixZQUFZYSxHQUFHLENBQUMsR0FBR0MsUUFBUUMsR0FBRyxDQUFDQyxRQUFRLEtBQUssZUFBZSxjQUFjLEdBQUcsc0JBQXNCLENBQUMsR0FBR0M7SUFDOUgsSUFBSSxDQUFDTCxpQkFBaUI7UUFDcEJqQyxTQUFTLEdBQUdvQixhQUFhRSxZQUFZO0lBQ3ZDO0lBQ0EsTUFBTWlCLHVCQUF1Qk4sZ0JBQWdCTyxLQUFLLENBQUMsS0FBS0MsRUFBRSxDQUFDO0lBQzNELElBQUksQ0FBQ0Ysc0JBQXNCO1FBQ3pCdkMsU0FBUyxHQUFHb0IsYUFBYUUsWUFBWTtJQUN2QztJQUNBLE1BQU0sRUFBRW9CLFdBQVdDLHFCQUFxQixFQUFFLEdBQUcsTUFBTTVCLFFBQVE2QixLQUFLLENBQUM7UUFDL0RDLFlBQVloQztRQUNaaUMsT0FBTztZQUNMQyxZQUFZO2dCQUNWQyxRQUFRVDtZQUNWO1FBQ0Y7SUFDRjtJQUNBLElBQUksQ0FBQ0ksdUJBQXVCO1FBQzFCM0MsU0FBUyxHQUFHb0IsYUFBYUUsWUFBWTtJQUN2QztJQUVBLHFCQUNFLEtBQUNkO1FBQWdCeUMsV0FBVTtrQkFDekIsY0FBQSxLQUFDL0M7WUFDQ0YsVUFBVXdCO1lBQ1YwQixpQkFBaUJ6QixrQkFBa0IwQixhQUFhQztZQUNoREMsU0FBU3pDLGNBQWNjLGlCQUFpQixFQUFFMkI7WUFDMUNDLFVBQVUxQyxjQUFjYyxpQkFBaUIsRUFBRTRCOzs7QUFJbkQ7QUFFQSxlQUFlN0MsZ0JBQWUifQ==