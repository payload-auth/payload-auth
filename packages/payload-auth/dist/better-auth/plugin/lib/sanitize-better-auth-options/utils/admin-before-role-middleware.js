import { createAuthMiddleware, getSessionFromCtx } from "better-auth/api";
/**
 * Sets up a middleware that converts session.user.role from an array to a single string seperated by commas. only for /admin routes
 */ export function adminBeforeRoleMiddleware({ sanitizedOptions }) {
    if (typeof sanitizedOptions.hooks !== 'object') sanitizedOptions.hooks = {};
    const originalBefore = sanitizedOptions.hooks.before;
    sanitizedOptions.hooks.before = createAuthMiddleware(async (ctx)=>{
        if (ctx.path.startsWith('/admin')) {
            await getSessionFromCtx(ctx);
            if (ctx.context.session && ctx.context.session.user && Array.isArray(ctx.context.session.user.role)) {
                ctx.context.session.user.role = ctx.context.session.user.role.join(',');
            }
        }
        if (typeof originalBefore === 'function') {
            originalBefore(ctx);
        }
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9iZXR0ZXItYXV0aC9wbHVnaW4vbGliL3Nhbml0aXplLWJldHRlci1hdXRoLW9wdGlvbnMvdXRpbHMvYWRtaW4tYmVmb3JlLXJvbGUtbWlkZGxld2FyZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVBdXRoTWlkZGxld2FyZSwgZ2V0U2Vzc2lvbkZyb21DdHggfSBmcm9tICdiZXR0ZXItYXV0aC9hcGknXG5pbXBvcnQgdHlwZSB7IFNhbml0aXplZEJldHRlckF1dGhPcHRpb25zIH0gZnJvbSAnQC9iZXR0ZXItYXV0aC9wbHVnaW4vdHlwZXMnXG5cbi8qKlxuICogU2V0cyB1cCBhIG1pZGRsZXdhcmUgdGhhdCBjb252ZXJ0cyBzZXNzaW9uLnVzZXIucm9sZSBmcm9tIGFuIGFycmF5IHRvIGEgc2luZ2xlIHN0cmluZyBzZXBlcmF0ZWQgYnkgY29tbWFzLiBvbmx5IGZvciAvYWRtaW4gcm91dGVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhZG1pbkJlZm9yZVJvbGVNaWRkbGV3YXJlKHsgc2FuaXRpemVkT3B0aW9ucyB9OiB7IHNhbml0aXplZE9wdGlvbnM6IFNhbml0aXplZEJldHRlckF1dGhPcHRpb25zIH0pIHtcbiAgaWYgKHR5cGVvZiBzYW5pdGl6ZWRPcHRpb25zLmhvb2tzICE9PSAnb2JqZWN0Jykgc2FuaXRpemVkT3B0aW9ucy5ob29rcyA9IHt9XG4gIGNvbnN0IG9yaWdpbmFsQmVmb3JlID0gc2FuaXRpemVkT3B0aW9ucy5ob29rcy5iZWZvcmVcbiAgc2FuaXRpemVkT3B0aW9ucy5ob29rcy5iZWZvcmUgPSBjcmVhdGVBdXRoTWlkZGxld2FyZShhc3luYyAoY3R4KSA9PiB7XG4gICAgaWYgKGN0eC5wYXRoLnN0YXJ0c1dpdGgoJy9hZG1pbicpKSB7XG4gICAgICBhd2FpdCBnZXRTZXNzaW9uRnJvbUN0eChjdHgpXG4gICAgICBpZiAoY3R4LmNvbnRleHQuc2Vzc2lvbiAmJiBjdHguY29udGV4dC5zZXNzaW9uLnVzZXIgJiYgQXJyYXkuaXNBcnJheShjdHguY29udGV4dC5zZXNzaW9uLnVzZXIucm9sZSkpIHtcbiAgICAgICAgY3R4LmNvbnRleHQuc2Vzc2lvbiEudXNlci5yb2xlID0gY3R4LmNvbnRleHQuc2Vzc2lvbi51c2VyLnJvbGUuam9pbignLCcpXG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb3JpZ2luYWxCZWZvcmUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIG9yaWdpbmFsQmVmb3JlKGN0eClcbiAgICB9XG4gIH0pXG59XG4iXSwibmFtZXMiOlsiY3JlYXRlQXV0aE1pZGRsZXdhcmUiLCJnZXRTZXNzaW9uRnJvbUN0eCIsImFkbWluQmVmb3JlUm9sZU1pZGRsZXdhcmUiLCJzYW5pdGl6ZWRPcHRpb25zIiwiaG9va3MiLCJvcmlnaW5hbEJlZm9yZSIsImJlZm9yZSIsImN0eCIsInBhdGgiLCJzdGFydHNXaXRoIiwiY29udGV4dCIsInNlc3Npb24iLCJ1c2VyIiwiQXJyYXkiLCJpc0FycmF5Iiwicm9sZSIsImpvaW4iXSwibWFwcGluZ3MiOiJBQUFBLFNBQVNBLG9CQUFvQixFQUFFQyxpQkFBaUIsUUFBUSxrQkFBaUI7QUFHekU7O0NBRUMsR0FDRCxPQUFPLFNBQVNDLDBCQUEwQixFQUFFQyxnQkFBZ0IsRUFBb0Q7SUFDOUcsSUFBSSxPQUFPQSxpQkFBaUJDLEtBQUssS0FBSyxVQUFVRCxpQkFBaUJDLEtBQUssR0FBRyxDQUFDO0lBQzFFLE1BQU1DLGlCQUFpQkYsaUJBQWlCQyxLQUFLLENBQUNFLE1BQU07SUFDcERILGlCQUFpQkMsS0FBSyxDQUFDRSxNQUFNLEdBQUdOLHFCQUFxQixPQUFPTztRQUMxRCxJQUFJQSxJQUFJQyxJQUFJLENBQUNDLFVBQVUsQ0FBQyxXQUFXO1lBQ2pDLE1BQU1SLGtCQUFrQk07WUFDeEIsSUFBSUEsSUFBSUcsT0FBTyxDQUFDQyxPQUFPLElBQUlKLElBQUlHLE9BQU8sQ0FBQ0MsT0FBTyxDQUFDQyxJQUFJLElBQUlDLE1BQU1DLE9BQU8sQ0FBQ1AsSUFBSUcsT0FBTyxDQUFDQyxPQUFPLENBQUNDLElBQUksQ0FBQ0csSUFBSSxHQUFHO2dCQUNuR1IsSUFBSUcsT0FBTyxDQUFDQyxPQUFPLENBQUVDLElBQUksQ0FBQ0csSUFBSSxHQUFHUixJQUFJRyxPQUFPLENBQUNDLE9BQU8sQ0FBQ0MsSUFBSSxDQUFDRyxJQUFJLENBQUNDLElBQUksQ0FBQztZQUN0RTtRQUNGO1FBQ0EsSUFBSSxPQUFPWCxtQkFBbUIsWUFBWTtZQUN4Q0EsZUFBZUU7UUFDakI7SUFDRjtBQUNGIn0=