import { createAuthMiddleware, getSessionFromCtx } from "better-auth/api";
/**
 * Sets up a middleware that converts session.user.role from an a single string seperated by commas back to an array only for /admin routes
 */ export function adminAfterRoleMiddleware({ sanitizedOptions }) {
    if (typeof sanitizedOptions.hooks !== 'object') sanitizedOptions.hooks = {};
    const originalAfter = sanitizedOptions.hooks.after;
    sanitizedOptions.hooks.after = createAuthMiddleware(async (ctx)=>{
        if (ctx.path.startsWith('/admin')) {
            await getSessionFromCtx(ctx);
            if (ctx.context.session && ctx.context.session.user && typeof ctx.context.session.user.role === 'string') {
                ctx.context.session.user.role = ctx.context.session.user.role.split(',').map((r)=>r.trim()).filter(Boolean);
            }
        }
        if (typeof originalAfter === 'function') {
            originalAfter(ctx);
        }
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9iZXR0ZXItYXV0aC9wbHVnaW4vbGliL3Nhbml0aXplLWJldHRlci1hdXRoLW9wdGlvbnMvdXRpbHMvYWRtaW4tYWZ0ZXItcm9sZS1taWRkbGV3YXJlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUF1dGhNaWRkbGV3YXJlLCBnZXRTZXNzaW9uRnJvbUN0eCB9IGZyb20gJ2JldHRlci1hdXRoL2FwaSdcbmltcG9ydCB0eXBlIHsgU2FuaXRpemVkQmV0dGVyQXV0aE9wdGlvbnMgfSBmcm9tICdAL2JldHRlci1hdXRoL3BsdWdpbi90eXBlcydcblxuLyoqXG4gKiBTZXRzIHVwIGEgbWlkZGxld2FyZSB0aGF0IGNvbnZlcnRzIHNlc3Npb24udXNlci5yb2xlIGZyb20gYW4gYSBzaW5nbGUgc3RyaW5nIHNlcGVyYXRlZCBieSBjb21tYXMgYmFjayB0byBhbiBhcnJheSBvbmx5IGZvciAvYWRtaW4gcm91dGVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhZG1pbkFmdGVyUm9sZU1pZGRsZXdhcmUoeyBzYW5pdGl6ZWRPcHRpb25zIH06IHsgc2FuaXRpemVkT3B0aW9uczogU2FuaXRpemVkQmV0dGVyQXV0aE9wdGlvbnMgfSkge1xuICBpZiAodHlwZW9mIHNhbml0aXplZE9wdGlvbnMuaG9va3MgIT09ICdvYmplY3QnKSBzYW5pdGl6ZWRPcHRpb25zLmhvb2tzID0ge31cbiAgY29uc3Qgb3JpZ2luYWxBZnRlciA9IHNhbml0aXplZE9wdGlvbnMuaG9va3MuYWZ0ZXJcbiAgc2FuaXRpemVkT3B0aW9ucy5ob29rcy5hZnRlciA9IGNyZWF0ZUF1dGhNaWRkbGV3YXJlKGFzeW5jIChjdHgpID0+IHtcbiAgICBpZiAoY3R4LnBhdGguc3RhcnRzV2l0aCgnL2FkbWluJykpIHtcbiAgICAgIGF3YWl0IGdldFNlc3Npb25Gcm9tQ3R4KGN0eClcbiAgICAgIGlmIChjdHguY29udGV4dC5zZXNzaW9uICYmIGN0eC5jb250ZXh0LnNlc3Npb24udXNlciAmJiB0eXBlb2YgY3R4LmNvbnRleHQuc2Vzc2lvbi51c2VyLnJvbGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGN0eC5jb250ZXh0LnNlc3Npb24hLnVzZXIucm9sZSA9IGN0eC5jb250ZXh0LnNlc3Npb24udXNlci5yb2xlXG4gICAgICAgICAgLnNwbGl0KCcsJylcbiAgICAgICAgICAubWFwKChyOiBzdHJpbmcpID0+IHIudHJpbSgpKVxuICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHR5cGVvZiBvcmlnaW5hbEFmdGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBvcmlnaW5hbEFmdGVyKGN0eClcbiAgICB9XG4gIH0pXG59XG4iXSwibmFtZXMiOlsiY3JlYXRlQXV0aE1pZGRsZXdhcmUiLCJnZXRTZXNzaW9uRnJvbUN0eCIsImFkbWluQWZ0ZXJSb2xlTWlkZGxld2FyZSIsInNhbml0aXplZE9wdGlvbnMiLCJob29rcyIsIm9yaWdpbmFsQWZ0ZXIiLCJhZnRlciIsImN0eCIsInBhdGgiLCJzdGFydHNXaXRoIiwiY29udGV4dCIsInNlc3Npb24iLCJ1c2VyIiwicm9sZSIsInNwbGl0IiwibWFwIiwiciIsInRyaW0iLCJmaWx0ZXIiLCJCb29sZWFuIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSxvQkFBb0IsRUFBRUMsaUJBQWlCLFFBQVEsa0JBQWlCO0FBR3pFOztDQUVDLEdBQ0QsT0FBTyxTQUFTQyx5QkFBeUIsRUFBRUMsZ0JBQWdCLEVBQW9EO0lBQzdHLElBQUksT0FBT0EsaUJBQWlCQyxLQUFLLEtBQUssVUFBVUQsaUJBQWlCQyxLQUFLLEdBQUcsQ0FBQztJQUMxRSxNQUFNQyxnQkFBZ0JGLGlCQUFpQkMsS0FBSyxDQUFDRSxLQUFLO0lBQ2xESCxpQkFBaUJDLEtBQUssQ0FBQ0UsS0FBSyxHQUFHTixxQkFBcUIsT0FBT087UUFDekQsSUFBSUEsSUFBSUMsSUFBSSxDQUFDQyxVQUFVLENBQUMsV0FBVztZQUNqQyxNQUFNUixrQkFBa0JNO1lBQ3hCLElBQUlBLElBQUlHLE9BQU8sQ0FBQ0MsT0FBTyxJQUFJSixJQUFJRyxPQUFPLENBQUNDLE9BQU8sQ0FBQ0MsSUFBSSxJQUFJLE9BQU9MLElBQUlHLE9BQU8sQ0FBQ0MsT0FBTyxDQUFDQyxJQUFJLENBQUNDLElBQUksS0FBSyxVQUFVO2dCQUN4R04sSUFBSUcsT0FBTyxDQUFDQyxPQUFPLENBQUVDLElBQUksQ0FBQ0MsSUFBSSxHQUFHTixJQUFJRyxPQUFPLENBQUNDLE9BQU8sQ0FBQ0MsSUFBSSxDQUFDQyxJQUFJLENBQzNEQyxLQUFLLENBQUMsS0FDTkMsR0FBRyxDQUFDLENBQUNDLElBQWNBLEVBQUVDLElBQUksSUFDekJDLE1BQU0sQ0FBQ0M7WUFDWjtRQUNGO1FBQ0EsSUFBSSxPQUFPZCxrQkFBa0IsWUFBWTtZQUN2Q0EsY0FBY0U7UUFDaEI7SUFDRjtBQUNGIn0=