---
title: Basic Usage
description: Learn the fundamentals of authentication with payload-auth
---

import { Tab, Tabs } from 'fumadocs-ui/components/tabs';
import { Callout } from 'fumadocs-ui/components/callout';

# Basic Usage

This guide covers the essential patterns for implementing authentication with payload-auth.

## Creating an Auth Client

First, create a client-side authentication client:

```ts title="lib/auth/client.ts"
import { createAuthClient } from 'better-auth/react'

export const authClient = createAuthClient({
  baseURL: process.env.NEXT_PUBLIC_SERVER_URL,
})

// Export commonly used functions
export const { signIn, signUp, signOut, useSession } = authClient
```

## Sign Up

### Client-Side Sign Up

```tsx title="components/sign-up-form.tsx"
'use client'

import { authClient } from '@/lib/auth/client'
import { useState } from 'react'

export function SignUpForm() {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    password: '',
  })
  const [error, setError] = useState('')

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')

const { data, error } = await authClient.signUp.email({
      ...formData,
    })

    if (error) {
      setError(error.message)
      return
    }

    // Redirect or show success
    window.location.href = '/dashboard'
  }

  return (
    <form onSubmit={handleSubmit}>
      {error && <div className="error">{error}</div>}
      <input
        type="text"
        placeholder="Name"
        value={formData.name}
        onChange={(e) => setFormData({ ...formData, name: e.target.value })}
      />
      <input
        type="email"
        placeholder="Email"
        value={formData.email}
        onChange={(e) => setFormData({ ...formData, email: e.target.value })}
      />
      <input
        type="password"
        placeholder="Password"
        value={formData.password}
        onChange={(e) => setFormData({ ...formData, password: e.target.value })}
      />
      <button type="submit">Sign Up</button>
    </form>
  )
}
```

## Sign In

### Client-Side Sign In

```tsx title="components/sign-in-form.tsx"
'use client'

import { authClient } from '@/lib/auth/client'
import { useState } from 'react'
import { useRouter } from 'next/navigation'

export function SignInForm() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [error, setError] = useState('')
  const router = useRouter()

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')

const { data, error } = await authClient.signIn.email({
        email,
        password,
    })

    if (error) {
      setError(error.message)
      return
    }

    router.push('/dashboard')
  }

  return (
    <form onSubmit={handleSubmit}>
      {error && <div className="error">{error}</div>}
      <input
        type="email"
        placeholder="Email"
        value={email}
        onChange={(e) => setEmail(e.target.value)}
      />
      <input
        type="password"
        placeholder="Password"
        value={password}
        onChange={(e) => setPassword(e.target.value)}
      />
      <button type="submit">Sign In</button>
    </form>
  )
}
```

## Using Sessions

### Client-Side Session Hook

```tsx title="components/user-menu.tsx"
'use client'

import { authClient } from '@/lib/auth/client'
import { useRouter } from 'next/navigation'

export function UserMenu() {
  const { data: session, isPending } = authClient.useSession()
  const router = useRouter()

  if (isPending) {
    return <span>Loading...</span>
  }

  if (!session) {
    return <a href="/login">Sign In</a>
  }

  const handleSignOut = async () => {
    await authClient.signOut()
    router.push('/')
  }

  return (
    <div>
      <span>Welcome, {session.user.name}</span>
      <button onClick={handleSignOut}>Sign Out</button>
    </div>
  )
}
```

### Server-Side Session

```tsx title="app/dashboard/page.tsx"
import { getPayloadAuth } from 'payload-auth/better-auth'
import config from '@payload-config'
import { headers } from 'next/headers'
import { redirect } from 'next/navigation'

export default async function DashboardPage() {
  const { betterAuth } = await getPayloadAuth(config)
  
  const session = await betterAuth.api.getSession({
    headers: await headers(),
  })
  
  if (!session) {
    redirect('/login')
  }

            return (
    <div>
      <h1>Welcome, {session.user.name}</h1>
      <p>Email: {session.user.email}</p>
      <p>Role: {session.user.role}</p>
    </div>
            )
        }
        ```

## Protected Routes

### Client-Side Protection

```tsx title="components/protected-content.tsx"
'use client'

import { authClient } from '@/lib/auth/client'
import { redirect } from 'next/navigation'
import { useEffect } from 'react'

export function ProtectedContent({ children }: { children: React.ReactNode }) {
  const { data: session, isPending } = authClient.useSession()

  useEffect(() => {
    if (!isPending && !session) {
      redirect('/login')
    }
  }, [session, isPending])

  if (isPending) {
    return <div>Loading...</div>
  }

  if (!session) {
    return null
  }

  return <>{children}</>
}
```

### Middleware Protection

```ts title="middleware.ts"
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

export function middleware(request: NextRequest) {
  const sessionCookie = request.cookies.get('better-auth.session_token')
  
  if (!sessionCookie && request.nextUrl.pathname.startsWith('/dashboard')) {
    return NextResponse.redirect(new URL('/login', request.url))
  }
  
  return NextResponse.next()
}

export const config = {
  matcher: ['/dashboard/:path*'],
}
```

## Using with Payload Operations

### Get Current User's Data

```ts title="lib/actions/get-user-posts.ts"
'use server'

import { getPayloadAuth } from 'payload-auth/better-auth'
import config from '@payload-config'
import { headers } from 'next/headers'

export async function getUserPosts() {
  const { betterAuth, payload } = await getPayloadAuth(config)
  
  const session = await betterAuth.api.getSession({
    headers: await headers(),
  })
  
  if (!session) {
    return []
  }
  
  const posts = await payload.find({
    collection: 'posts',
    where: {
      author: { equals: session.user.id },
    },
  })
  
  return posts.docs
}
```

### Create Data for Current User

```ts title="lib/actions/create-post.ts"
'use server'

import { getPayloadAuth } from 'payload-auth/better-auth'
import config from '@payload-config'
import { headers } from 'next/headers'

export async function createPost(data: { title: string; content: string }) {
  const { betterAuth, payload } = await getPayloadAuth(config)
  
  const session = await betterAuth.api.getSession({
    headers: await headers(),
  })
  
  if (!session) {
    throw new Error('Unauthorized')
  }
  
  const post = await payload.create({
    collection: 'posts',
    data: {
      ...data,
      author: session.user.id,
    },
  })
  
  return post
}
```

## Error Handling

```ts
const { data, error } = await authClient.signIn.email({
  email,
  password,
})

if (error) {
  switch (error.code) {
    case 'INVALID_CREDENTIALS':
      showError('Invalid email or password')
      break
    case 'EMAIL_NOT_VERIFIED':
      showError('Please verify your email first')
      break
    case 'USER_BANNED':
      showError('Your account has been suspended')
      break
    default:
      showError(error.message)
  }
}
```

## Next Steps

- [Configuration](/docs/configuration) - Customize the plugin
- [Social Providers](/docs/authentication/social-providers) - Add OAuth login
- [Two-Factor Auth](/docs/authentication/two-factor) - Add 2FA security
