---
title: Admin Plugin
description: User management and impersonation
---

import { Callout } from 'fumadocs-ui/components/callout';

# Admin Plugin

The admin plugin provides administrative capabilities for managing users.

## Features

- User impersonation
- User banning
- Role management via API
- User creation by admins

## Configuration

```ts
import { admin } from 'better-auth/plugins'

betterAuthPlugin({
  betterAuthOptions: {
        plugins: [
      admin({
        impersonationSessionDuration: 60 * 60, // 1 hour in seconds
        defaultRole: 'user',
        adminRole: 'admin',
      }),
    ],
  },
  users: {
    adminRoles: ['admin'], // Must match adminRole
  },
})
```

### Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `impersonationSessionDuration` | `number` | `3600` | How long impersonation lasts |
| `defaultRole` | `string` | `'user'` | Default role for new users |
| `adminRole` | `string` | `'admin'` | Role with admin privileges |

## Client Setup

```ts
import { createAuthClient } from 'better-auth/react'
import { adminClient } from 'better-auth/plugins/admin/client'

export const authClient = createAuthClient({
  baseURL: process.env.NEXT_PUBLIC_SERVER_URL,
  plugins: [adminClient()],
})
```

## User Impersonation

Impersonate a user to debug their account:

```tsx
// Start impersonation
const { data, error } = await authClient.admin.impersonateUser({
  userId: 'user-id-to-impersonate',
})

// Check if impersonating
const { data: session } = authClient.useSession()
if (session?.session.impersonatedBy) {
  console.log('Being impersonated by:', session.session.impersonatedBy)
}

// Stop impersonation
await authClient.admin.stopImpersonation()
```

## User Banning

Prevent users from signing in:

```tsx
// Ban a user
await authClient.admin.banUser({
  userId: 'user-id',
  banReason: 'Violation of terms',
  banExpiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // 7 days
})

// Unban a user
await authClient.admin.unbanUser({
  userId: 'user-id',
})
```

When banned:
- User cannot sign in
- Active sessions are invalidated
- `user.banned` is set to `true`

## Role Management

Update user roles:

```tsx
await authClient.admin.setRole({
  userId: 'user-id',
  role: 'admin',
})
```

## Server-Side Admin Actions

```ts
import { getPayloadAuth } from 'payload-auth/better-auth'
import config from '@payload-config'

export async function banUser(userId: string) {
  const { betterAuth } = await getPayloadAuth(config)
  
  await betterAuth.api.banUser({
  body: {
      userId,
      banReason: 'Admin action',
    },
  })
}
```

## Impersonation UI

payload-auth provides an impersonation banner component:

```tsx
import { ImpersonatingBar } from 'payload-auth/better-auth/client'

export function Layout({ children }: { children: React.ReactNode }) {
  return (
    <>
      <ImpersonatingBar />
      {children}
    </>
  )
}
```

This shows a banner when an admin is impersonating a user, with a button to stop.

## Admin Invitations

payload-auth extends admin functionality with invitations:

```ts
betterAuthPlugin({
  requireAdminInviteForSignUp: true,
  adminInvitations: {
    sendInviteEmail: async ({ payload, email, url }) => {
      await payload.sendEmail({
        to: email,
        subject: 'You are invited',
        html: `<a href="${url}">Accept Invitation</a>`,
      })
      return { success: true }
    },
  },
})
```

<Callout type="info">
Admin endpoints (invite, set role, ban) are available in Payload admin through custom endpoints on the users collection.
</Callout>
